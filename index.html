<!doctype html>
<html lang="th">
  <head>
    <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Metadata ‡πÅ‡∏•‡∏∞ Title ‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bill Splitter</title>

    <!-- Google Font K2D ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö -->
    <link href="https://fonts.googleapis.com/css2?family=K2D:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- SDK ‡∏Ç‡∏≠‡∏á Canva Element (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô Canva) -->
    <script src="/_sdk/element_sdk.js"></script>

    <!-- TailwindCSS CDN (‡πÉ‡∏ä‡πâ‡∏ö‡∏≤‡∏á Class ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏ß‡πâ ‡πÄ‡∏ä‡πà‡∏ô .w-full ‡∏Ø‡∏•‡∏Ø) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- OCR ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏¥‡∏• (Tesseract.js) -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

    <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏ß‡πá‡∏ö (CSS Global) -->
    <style>
      /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡πÅ‡∏•‡∏∞ box-sizing ‡πÉ‡∏´‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏ô‡πâ‡∏≤ */
      body {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: 'K2D', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }

      * {
        box-sizing: border-box;
      }

      /* ‡πÅ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡∏ô‡πÄ‡∏ü‡∏î‡πÄ‡∏Ç‡πâ‡∏≤ */
      .fade-in {
        animation: fadeIn 0.3s ease-in;
      }

      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
      }

      /* ‡πÅ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡∏ô‡∏™‡πÑ‡∏•‡∏î‡πå‡πÄ‡∏Ç‡πâ‡∏≤ */
      .slide-in {
        animation: slideIn 0.4s ease-out;
      }

      @keyframes slideIn {
        from { opacity: 0; transform: translateX(-20px); }
        to { opacity: 1; transform: translateX(0); }
      }

      /* ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏ï‡∏≠‡∏ô‡πÇ‡∏ü‡∏Å‡∏±‡∏™ input / select / textarea */
      input:focus, select:focus, textarea:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(251, 146, 60, 0.2);
      }

      /* ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå hover ‡∏Ç‡∏≠‡∏á card */
      .card-hover:hover {
        transform: translateY(-2px);
        transition: transform 0.2s ease;
      }

      /* ‡∏™‡πÑ‡∏ï‡∏•‡πå checkbox ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏¥‡∏ô‡πÄ‡∏°‡∏ô‡∏π */
      .checkbox-custom {
        width: 20px;
        height: 20px;
        cursor: pointer;
        accent-color: #fb923c;
      }

      /* ‡πÄ‡∏•‡πÄ‡∏¢‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á modal (‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠) */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        padding: 20px;
      }

      .modal-content {
        max-width: 900px;
        max-height: 90%;
        overflow-y: auto;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      }
    </style>

    <!-- ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ view-transition ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö) -->
    <style>@view-transition { navigation: auto; }</style>

    <!-- SDK ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö data (‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö Canva) -->
    <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  </head>
  <body>
    <!-- ‡∏ï‡∏±‡∏ß‡∏´‡πà‡∏≠‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á App ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î -->
    <div id="app-wrapper" class="w-full min-h-full"></div>

    <script>
      // -----------------------------
      // CONFIG ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ (‡∏ò‡∏µ‡∏°/‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°)
      // -----------------------------
      const defaultConfig = {
        background_color: "#F0FFFF",
        surface_color: "#ffffff",
        text_color: "#000000",
        primary_action_color: "#0fa404",
        secondary_action_color: "#0ea5e9",
        app_title: "üßæ ‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏¢‡∏∏‡∏ï‡∏¥‡∏ò‡∏£‡∏£‡∏°",
        app_subtitle: "‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢‡∏î‡∏≤‡∏¢ ‡πÅ‡∏¢‡∏Å‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô",
        total_amount_label: "üíµ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏ö‡∏≤‡∏ó)",
        people_section_title: "üë• ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°",
        add_person_button: "+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ô",
        items_section_title: "üçΩÔ∏è ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°",
        add_item_button: "+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£",
        scan_bill_button: "üì∑ ‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏¥‡∏•",
        calculate_button: " ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì",
        reset_button: " ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï",
        summary_title: "üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£",
        view_summary_button: "üìã ‡∏î‡∏π‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ",
        contact_title: "üìû ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠",
        contact_method_1: "‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå",
        contact_detail_1: "0xx-xxx-xxxx",
        contact_method_2: "Line ID",
        contact_detail_2: "@yourlineid",
        font_family: "K2D",
        font_size: 16
      };

      // -----------------------------
      // STATE ‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏õ (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤)
      // -----------------------------
      let people = [];      // ‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°
      let items = [];       // ‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°
      let showScanModal = false;
      let scanBusy = false;
      let scanProgress = 0;
      let scanError = "";
      let scanRawText = "";

      let totalAmount = 0;  // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏ö‡∏¥‡∏•
      let showSummaryModal = false;
      let currentView = 'main'; // main, payment, contact, summary, guide

      // ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
      let paymentMethods = [
        { id: 1, name: 'PromptPay',          detail: '0xx-xxx-xxxx',               icon: 'üí≥' },
        { id: 2, name: '‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£',             detail: ' ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ç‡∏ä‡∏µ xxx-x-xxxxx-x', icon: 'üè¶' },
        { id: 3, name: 'True Money Wallet',  detail: '0xx-xxx-xxxx',               icon: 'üí∞' }
      ];

      // ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
      let contactMethods = [
        { id: 1, name: '‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå', detail: '0xx-xxx-xxxx' },
        { id: 2, name: 'Line ID',  detail: '@yourlineid' },
        { id: 3, name: 'Facebook', detail: 'facebook.com/yourpage' }
      ];

      // -----------------------------
      // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°
      // -----------------------------
      function addPerson() {
        const personId = Date.now();
        people.push({
          id: personId,
          name: `‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà ${people.length + 1}`
        });
        renderPeople();
        renderItems();
      }

      function removePerson(personId) {
        people = people.filter(p => p.id !== personId);
        items.forEach(item => {
          item.consumers = item.consumers.filter(id => id !== personId);
        });
        renderPeople();
        renderItems();
      }

      function updatePersonName(personId, name) {
        const person = people.find(p => p.id === personId);
        if (person) {
          person.name = name;
          renderItems();
        }
      }

      // -----------------------------
      // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°
      // -----------------------------
      function addItem() {
        const itemId = Date.now();
        items.push({
          id: itemId,
          name: '',
          price: 0,
          type: 'food',
          consumers: []
        });
        renderItems();
      }

      function removeItem(itemId) {
        items = items.filter(i => i.id !== itemId);
        renderItems();
      }

      function updateItemName(itemId, name) {
        const item = items.find(i => i.id === itemId);
        if (item) {
          item.name = name;
        }
      }

      function updateItemPrice(itemId, price) {
        const item = items.find(i => i.id === itemId);
        if (item) {
          item.price = parseFloat(price) || 0;
        }
      }

      function updateItemType(itemId, type) {
        const item = items.find(i => i.id === itemId);
        if (item) {
          item.type = type;
          renderItems();
        }
      }

      function toggleConsumer(itemId, personId) {
        const item = items.find(i => i.id === itemId);
        if (item) {
          const index = item.consumers.indexOf(personId);
          if (index > -1) {
            item.consumers.splice(index, 1);
          } else {
            item.consumers.push(personId);
          }
          renderItems();
        }
      }

      
      // -----------------------------
      // ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå "‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏¥‡∏•" (OCR) -> ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏•‡∏á‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢
      // -----------------------------
      function openBillScan() {
        const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
        if (typeof Tesseract === 'undefined') {
          showToast('‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ OCR (Tesseract.js) ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï/‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå CDN', config.secondary_action_color || defaultConfig.secondary_action_color);
          return;
        }
        showScanModal = true;
        scanBusy = false;
        scanProgress = 0;
        scanError = "";
        scanRawText = "";
        renderApp();
      }

      function closeBillScan() {
        showScanModal = false;
        scanBusy = false;
        scanProgress = 0;
        scanError = "";
        scanRawText = "";
        renderApp();
      }

      function normalizeMoney(str) {
        if (!str) return null;
        const cleaned = String(str)
          .replace(/‡∏ø/g, '')
          .replace(/,/g, '')
          .replace(/\s/g, '')
          .replace(/(\d)\.(?=\d{3}(\D|$))/g, '$1'); // ‡∏Å‡∏±‡∏ô‡∏Å‡∏£‡∏ì‡∏µ OCR ‡πÉ‡∏™‡πà‡∏à‡∏∏‡∏î‡∏Ñ‡∏±‡πà‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏û‡∏±‡∏ô
        const num = parseFloat(cleaned);
        return Number.isFinite(num) ? num : null;
      }

      function parseReceiptTextToItems(text) {
        const lines = String(text || '')
          .split(/\r?\n/)
          .map(l => l.trim())
          .filter(Boolean)
          .map(l => l.replace(/\s{2,}/g, ' '));

        const blacklist = /(vat|tax|service|subtotal|sub total|discount|change|cash|tender|round|‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô|‡∏£‡∏ß‡∏°‡πÄ‡∏á‡∏¥‡∏ô|‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏≠‡∏ô|‡∏†‡∏≤‡∏©‡∏µ|‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£|‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î)/i;

        let detectedTotal = null;
        const totalRegex = /(total|grand\s*total|‡∏¢‡∏≠‡∏î\s*‡∏£‡∏ß‡∏°|‡∏£‡∏ß‡∏°\s*‡∏ó‡∏±‡πâ‡∏á\s*‡∏™‡∏¥‡πâ‡∏ô|‡∏£‡∏ß‡∏°\s*‡πÄ‡∏á‡∏¥‡∏ô)\s*[:Ôºö]?\s*([0-9][0-9,\.]{1,})/i;

        const parsedItems = [];

        for (const line of lines) {
          // ‡∏´‡∏≤ Total (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
          const mTotal = line.match(totalRegex);
          if (mTotal && detectedTotal === null) {
            const t = normalizeMoney(mTotal[2]);
            if (t !== null) detectedTotal = t;
            continue;
          }

          // ‡∏ï‡∏±‡∏î‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
          if (blacklist.test(line)) continue;

          // ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ: "‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£  120.00" ‡∏´‡∏£‡∏∑‡∏≠ "‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ 120"
          const m = line.match(/^(.{2,}?)\s+(-?\d{1,7}(?:[\.,]\d{2})?)$/);
          if (m) {
            const name = m[1].trim().replace(/[-‚Äì‚Äî]+$/g, '').trim();
            const price = normalizeMoney(m[2].replace(',', '.'));
            if (name && price !== null && price >= 0) {
              // ‡∏Å‡∏£‡∏≠‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏î‡∏π‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î/‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
              if (!/^\d{2,}[\/\-]\d{1,2}[\/\-]\d{1,4}$/.test(name) && name.length <= 60) {
                parsedItems.push({ name, price, type: 'food' });
              }
            }
          }
        }

        // ‡∏Å‡∏±‡∏ô OCR ‡∏≠‡πà‡∏≤‡∏ô‡∏ã‡πâ‡∏≥/‡∏ú‡∏¥‡∏î: ‡∏ï‡∏±‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏Ñ‡∏≤‡∏®‡∏π‡∏ô‡∏¢‡πå/‡∏ã‡πâ‡∏≥‡πÅ‡∏ö‡∏ö‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
        const uniq = [];
        const seen = new Set();
        for (const it of parsedItems) {
          const key = (it.name + '|' + it.price).toLowerCase();
          if (seen.has(key)) continue;
          seen.add(key);
          uniq.push(it);
        }

        return { items: uniq, total: detectedTotal };
      }

      async function handleBillFile(file) {
        const config = window.elementSdk ? window.elementSdk.config : defaultConfig;

        if (!file) return;
        scanBusy = true;
        scanProgress = 0;
        scanError = "";
        scanRawText = "";
        renderApp();

        try {
          const result = await Tesseract.recognize(
            file,
            'tha+eng',
            {
              logger: (m) => {
                if (m && m.status === 'recognizing text' && typeof m.progress === 'number') {
                  scanProgress = Math.round(m.progress * 100);
                  // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÅ‡∏ö‡∏ö‡πÄ‡∏ö‡∏≤ ‡πÜ
                  const prog = document.getElementById('scan-progress-text');
                  const bar = document.getElementById('scan-progress-bar');
                  if (prog) prog.textContent = scanProgress + '%';
                  if (bar) bar.style.width = scanProgress + '%';
                }
              }
            }
          );

          scanRawText = (result && result.data && result.data.text) ? result.data.text : '';
          const parsed = parseReceiptTextToItems(scanRawText);

          if (!parsed.items.length) {
            showToast('‡∏™‡πÅ‡∏Å‡∏ô‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡∏•‡∏≠‡∏á‡∏ñ‡πà‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô/‡πÑ‡∏°‡πà‡πÄ‡∏≠‡∏µ‡∏¢‡∏á/‡πÅ‡∏™‡∏á‡∏û‡∏≠‡∏î‡∏µ)', config.secondary_action_color || defaultConfig.secondary_action_color);
            scanBusy = false;
            renderApp();
            return;
          }

          // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤ items
          const baseId = Date.now();
          parsed.items.forEach((it, idx) => {
            items.push({
              id: baseId + idx,
              name: it.name,
              price: it.price,
              type: it.type || 'food',
              consumers: []
            });
          });

          // ‡∏ñ‡πâ‡∏≤‡∏û‡∏ö‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° ‡πÅ‡∏•‡∏∞‡∏ä‡πà‡∏≠‡∏á‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏¢‡∏±‡∏á‡∏ß‡πà‡∏≤‡∏á/‡πÄ‡∏õ‡πá‡∏ô 0 -> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ
          if (parsed.total !== null && (!totalAmount || totalAmount <= 0)) {
            totalAmount = parsed.total;
          }

          showToast(`‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≤‡∏Å‡∏ö‡∏¥‡∏•‡πÅ‡∏•‡πâ‡∏ß ${parsed.items.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‚úì`, '#077204');
          scanBusy = false;
          showScanModal = false;

          renderMainView(); // ‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
        } catch (err) {
          console.error(err);
          scanError = (err && err.message) ? err.message : String(err);
          showToast('‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏¥‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + scanError, config.secondary_action_color || defaultConfig.secondary_action_color);
          scanBusy = false;
          renderApp();
        }
      }

// -----------------------------
      // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
      // -----------------------------
      function addPaymentMethod() {
        const newId = Math.max(...paymentMethods.map(p => p.id), 0) + 1;
        paymentMethods.push({
          id: newId,
          name: '‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà',
          detail: '',
          icon: 'üíµ'
        });
        renderPaymentMethodsEdit();
      }

      function removePaymentMethod(id) {
        const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
        if (paymentMethods.length <= 1) {
          showToast('‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á', config.secondary_action_color || defaultConfig.secondary_action_color);
          return;
        }
        paymentMethods = paymentMethods.filter(p => p.id !== id);
        renderPaymentMethodsEdit();
      }

      function updatePaymentMethod(id, field, value) {
        const method = paymentMethods.find(p => p.id === id);
        if (method) {
          method[field] = value;
        }
      }

      // -----------------------------
      // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠
      // -----------------------------
      function addContactMethod() {
        const newId = Math.max(...contactMethods.map(c => c.id), 0) + 1;
        contactMethods.push({
          id: newId,
          name: '‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà',
          detail: ''
        });
        renderContactMethodsEdit();
      }

      function removeContactMethod(id) {
        const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
        if (contactMethods.length <= 1) {
          showToast('‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á', config.secondary_action_color || defaultConfig.secondary_action_color);
          return;
        }
        contactMethods = contactMethods.filter(c => c.id !== id);
        renderContactMethodsEdit();
      }

      function updateContactMethod(id, field, value) {
        const method = contactMethods.find(c => c.id === id);
        if (method) {
          method[field] = value;
        }
      }

      // -----------------------------
      // ‡∏™‡πà‡∏ß‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (‡∏´‡∏ô‡πâ‡∏≤ Payment)
      // -----------------------------
      function renderPaymentMethodsEdit() {
        const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
        const container = document.getElementById('payment-methods-container');
        if (!container) return;

        let html = '';
        paymentMethods.forEach((method, index) => {
          html += `
            <div class="slide-in" style="background: ${config.background_color || defaultConfig.background_color}; border-radius: 12px; padding: 24px; margin-bottom: 16px; animation-delay: ${index * 0.1}s;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h3 style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.125}px; font-weight: 700; margin: 0;">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà ${index + 1}</h3>
                ${paymentMethods.length > 1 ? `
                  <button
                    onclick="removePaymentMethod(${method.id})"
                    style="padding: 8px 16px; background: ${config.secondary_action_color || defaultConfig.secondary_action_color}; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: ${(config.font_size || defaultConfig.font_size) * 0.75}px; font-weight: 600;"
                  >üóëÔ∏è ‡∏•‡∏ö</button>
                ` : ''}
              </div>

              <div style="margin-bottom: 16px;">
                <label for="payment-name-${method.id}" style="display: block; color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 700; margin-bottom: 8px;">‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á</label>
                <input
                  id="payment-name-${method.id}"
                  type="text"
                  value="${method.name}"
                  onchange="updatePaymentMethod(${method.id}, 'name', this.value)"
                  placeholder="‡πÄ‡∏ä‡πà‡∏ô PromptPay, ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£, True Money"
                  style="width: 100%; padding: 12px 16px; border: 2px solid white; border-radius: 8px; font-size: ${(config.font_size || defaultConfig.font_size)}px; color: ${config.text_color || defaultConfig.text_color}; font-weight: 600;"
                />
              </div>

              <div>
                <label for="payment-detail-${method.id}" style="display: block; color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.75}px; font-weight: 600; margin-bottom: 8px; opacity: 0.7;">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                <textarea
                  id="payment-detail-${method.id}"
                  onchange="updatePaymentMethod(${method.id}, 'detail', this.value)"
                  placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ç‡∏ä‡∏µ, ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£, QR Code"
                  rows="2"
                  style="width: 100%; padding: 12px 16px; border: 2px solid white; border-radius: 8px; font-size: ${(config.font_size || defaultConfig.font_size)}px; color: ${config.text_color || defaultConfig.text_color}; font-weight: 600; resize: vertical;"
                >${method.detail}</textarea>
              </div>
            </div>
          `;
        });

        container.innerHTML = html;
      }

      // -----------------------------
      // ‡∏™‡πà‡∏ß‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ (‡∏´‡∏ô‡πâ‡∏≤ Contact)
      // -----------------------------
      function renderContactMethodsEdit() {
        const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
        const container = document.getElementById('contact-methods-container');
        if (!container) return;

        let html = '';
        contactMethods.forEach((method, index) => {
          html += `
            <div class="slide-in" style="background: ${config.background_color || defaultConfig.background_color}; border-radius: 12px; padding: 24px; margin-bottom: 16px; animation-delay: ${index * 0.1}s;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h3 style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.125}px; font-weight: 700; margin: 0;">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà ${index + 1}</h3>
                ${contactMethods.length > 1 ? `
                  <button
                    onclick="removeContactMethod(${method.id})"
                    style="padding: 8px 16px; background: ${config.secondary_action_color || defaultConfig.secondary_action_color}; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: ${(config.font_size || defaultConfig.font_size) * 0.75}px; font-weight: 600;"
                  >üóëÔ∏è ‡∏•‡∏ö</button>
                ` : ''}
              </div>

              <div style="margin-bottom: 16px;">
                <label for="contact-name-${method.id}" style="display: block; color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 700; margin-bottom: 8px;">‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á</label>
                <input
                  id="contact-name-${method.id}"
                  type="text"
                  value="${method.name}"
                  onchange="updateContactMethod(${method.id}, 'name', this.value)"
                  placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå, Line ID, Facebook, Email"
                  style="width: 100%; padding: 12px 16px; border: 2px solid white; border-radius: 8px; font-size: ${(config.font_size || defaultConfig.font_size)}px; color: ${config.text_color || defaultConfig.text_color}; font-weight: 600;"
                />
              </div>

              <div>
                <label for="contact-detail-${method.id}" style="display: block; color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.75}px; font-weight: 600; margin-bottom: 8px; opacity: 0.7;">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                <textarea
                  id="contact-detail-${method.id}"
                  onchange="updateContactMethod(${method.id}, 'detail', this.value)"
                  placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£, Line ID, ‡∏•‡∏¥‡∏á‡∏Å‡πå Facebook, ‡∏≠‡∏µ‡πÄ‡∏°‡∏•"
                  rows="2"
                  style="width: 100%; padding: 12px 16px; border: 2px solid white; border-radius: 8px; font-size: ${(config.font_size || defaultConfig.font_size)}px; color: ${config.text_color || defaultConfig.text_color}; font-weight: 600; resize: vertical;"
                >${method.detail}</textarea>
              </div>
            </div>
          `;
        });

        container.innerHTML = html;
      }

      // -----------------------------
      // ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ
      // -----------------------------
      function renderPaymentMethodsModal() {
        const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
        let html = '';

        paymentMethods.forEach((method) => {
          html += `
            <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
              <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                <span style="font-size: ${(config.font_size || defaultConfig.font_size) * 1.5}px;">${method.icon}</span>
                <span style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size)}px; font-weight: 700;">${method.name}</span>
              </div>
              <div style="background: ${config.background_color || defaultConfig.background_color}; padding: 12px 16px; border-radius: 6px; color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 600; word-break: break-word;">
                ${method.detail}
              </div>
            </div>
          `;
        });

        return html;
      }

      // -----------------------------
      // ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ
      // -----------------------------
      function renderContactMethodsModal() {
        const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
        let html = '';

        contactMethods.forEach((method) => {
          html += `
            <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
              <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.75}px; font-weight: 600; margin-bottom: 8px; opacity: 0.7;">${method.name}</div>
              <div style="background: ${config.background_color || defaultConfig.background_color}; padding: 12px 16px; border-radius: 6px; color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 600; word-break: break-word;">
                ${method.detail}
              </div>
            </div>
          `;
        });

        return html;
      }

      // -----------------------------
      // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å input
      // -----------------------------
      function saveTotalAmount() {
        const totalInput = document.getElementById('total-amount');
        if (totalInput) {
          totalAmount = parseFloat(totalInput.value) || 0;
        }
      }

      // -----------------------------
      // ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ
      // -----------------------------
      function openSummaryModal() {
        const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
        saveTotalAmount();

        if (totalAmount <= 0) {
          showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', config.secondary_action_color || defaultConfig.secondary_action_color);
          return;
        }

        if (people.length === 0) {
          showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ñ‡∏ô', config.secondary_action_color || defaultConfig.secondary_action_color);
          return;
        }

        currentView = 'summary';
        renderApp();
      }

      function closeSummaryModal() {
        currentView = 'main';
        renderApp();
      }

      // ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
      function openPaymentPage() {
        currentView = 'payment';
        renderApp();
      }

      // ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠
      function openContactPage() {
        currentView = 'contact';
        renderApp();
      }

      // ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
      function openGuidePage() {
        currentView = 'guide';
        renderApp();
      }

      // ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á ‡πÜ
      function backToMain() {
        currentView = 'main';
        renderApp();
      }

      // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (‡πÅ‡∏™‡∏î‡∏á Toast ‡πÅ‡∏•‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å)
      function savePaymentInfo() {
        showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‚úì', '#077204');
        currentView = 'main';
        renderApp();
      }

      // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ (‡πÅ‡∏™‡∏î‡∏á Toast ‡πÅ‡∏•‡∏∞‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å)
      function saveContactInfo() {
        showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß ‚úì', '#077204');
        currentView = 'main';
        renderApp();
      }

      // -----------------------------
      // ‡∏´‡∏ô‡πâ‡∏≤ "‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£" (Summary View)
      // -----------------------------
      function renderSummaryPage() {
        const config = window.elementSdk ? window.elementSdk.config : defaultConfig;

        let itemsTotal = 0;
        items.forEach(item => {
          itemsTotal += item.price;
        });

        const sharedAmount = totalAmount - itemsTotal;
        const perPersonShared = sharedAmount / people.length;

        let summaryHtml = `
          <main style="max-width: 1000px; margin: 0 auto;">
            <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 20px; padding: 40px; box-shadow: 0 12px 40px rgba(0,0,0,0.12);">
              <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å -->
              <div style="display: flex; align-items: center; margin-bottom: 32px;">
                <button
                  onclick="closeSummaryModal()"
                  style="
                    width: 44px;
                    height: 44px;
                    background: ${config.background_color || defaultConfig.background_color};
                    color: ${config.text_color || defaultConfig.text_color};
                    border: none;
                    border-radius: 50%;
                    cursor: pointer;
                    font-size: ${(config.font_size || defaultConfig.font_size) * 1.7}px;
                    font-weight: 900;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    margin-right: 16px;
                    flex-shrink: 0;
                  "
                >‚Üê</button>
                <h1 style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 2}px; font-weight: 900; margin: 0;">${config.summary_title || defaultConfig.summary_title}</h1>
              </div>

              <!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î -->
              <div style="background: ${config.background_color || defaultConfig.background_color}; border-radius: 12px; padding: 24px; margin-bottom: 32px; border: 2px solid ${config.primary_action_color || defaultConfig.primary_action_color};">
                <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; margin-bottom: 8px; font-weight: 600;">üíµ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                <div style="color: ${config.primary_action_color || defaultConfig.primary_action_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 2.5}px; font-weight: 800;">${totalAmount.toFixed(2)} ‡∏ø</div>
              </div>

              <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° -->
              <div style="background: ${config.background_color || defaultConfig.background_color}; border-radius: 12px; padding: 24px; margin-bottom: 32px;">
                <h3 style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.5}px; font-weight: 800; margin: 0 0 20px 0;">üë• ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° (${people.length} ‡∏Ñ‡∏ô)</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 12px;">
        `;

        people.forEach((person, index) => {
          summaryHtml += `
            <div style="background: white; padding: 14px; border-radius: 8px; display: flex; align-items: center; gap: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
              <span style="background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: white; width: 28px; height: 28px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-weight: 700; font-size: ${(config.font_size || defaultConfig.font_size) * 0.75}px; flex-shrink: 0;">${index + 1}</span>
              <span style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 600; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${person.name}</span>
            </div>
          `;
        });

        summaryHtml += `
                </div>
              </div>

              <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î -->
              <div style="background: ${config.background_color || defaultConfig.background_color}; border-radius: 12px; padding: 24px; margin-bottom: 32px;">
                <h3 style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.5}px; font-weight: 800; margin: 0 0 20px 0;">üçΩÔ∏è ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏° (${items.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</h3>
        `;

        if (items.length === 0) {
          summaryHtml += `
            <div style="text-align: center; padding: 40px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.5;">
              <div style="font-size: ${(config.font_size || defaultConfig.font_size) * 2}px; margin-bottom: 8px;">üçΩÔ∏è</div>
              <div style="font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
            </div>
          `;
        } else {
          items.forEach((item) => {
            const icon = item.type === 'food' ? 'üçΩÔ∏è' : 'ü•§';
            const consumerNames = item.consumers.map(cid => {
              const p = people.find(person => person.id === cid);
              return p ? p.name : '';
            }).filter(n => n).join(', ');

            summaryHtml += `
              <div style="background: white; padding: 16px; border-radius: 8px; margin-bottom: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                  <div style="flex: 1;">
                    <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size)}px; font-weight: 700; margin-bottom: 4px;">
                      <span style="margin-right: 8px;">${icon}</span>${item.name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠'}
                    </div>
                    <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.75}px; opacity: 0.7;">
                      ${consumerNames || '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á'}
                    </div>
                  </div>
                  <div style="color: ${config.primary_action_color || defaultConfig.primary_action_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.125}px; font-weight: 700; white-space: nowrap; margin-left: 16px;">
                    ${item.price.toFixed(2)} ‡∏ø
                  </div>
                </div>
              </div>
            `;
          });

          summaryHtml += `
            <div style="background: white; padding: 16px; border-radius: 8px; border: 2px solid ${config.primary_action_color || defaultConfig.primary_action_color}; margin-top: 16px;">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <span style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.125}px; font-weight: 700;">‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:</span>
                <span style="color: ${config.primary_action_color || defaultConfig.primary_action_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.5}px; font-weight: 800;">${itemsTotal.toFixed(2)} ‡∏ø</span>
              </div>
            </div>
          `;
        }

        summaryHtml += `
              </div>

              <!-- ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô -->
              <div style="background: ${config.background_color || defaultConfig.background_color}; border-radius: 12px; padding: 24px; margin-bottom: 32px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                  <h3 style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.5}px; font-weight: 800; margin: 0;">üí≥ ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h3>
                </div>
                ${renderPaymentMethodsModal()}
              </div>

              <!-- ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ -->
              <div style="background: ${config.background_color || defaultConfig.background_color}; border-radius: 12px; padding: 24px; margin-bottom: 32px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                  <h3 style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.5}px; font-weight: 800; margin: 0;">üìû ‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</h3>
                </div>
                ${renderContactMethodsModal()}
              </div>

              <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å -->
              <div style="display: flex; justify-content: center; margin-top: 8px;">
                <button
                  onclick="closeSummaryModal()"
                  style="padding: 14px 32px; background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: white; border: none; border-radius: 12px; cursor: pointer; font-size: ${(config.font_size || defaultConfig.font_size) * 1.0}px; font-weight: 800; box-shadow: 0 6px 12px rgba(0,0,0,0.15);"
                >‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
              </div>
            </div>
          </main>
        `;

        return summaryHtml;
      }

      // -----------------------------
      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡∏£‡∏ö‡∏¥‡∏•
      // -----------------------------
      function calculateSplit() {
        const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
        const totalInput = document.getElementById('total-amount');
        totalAmount = parseFloat(totalInput.value) || 0;

        if (totalAmount <= 0) {
          showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', config.secondary_action_color || defaultConfig.secondary_action_color);
          return;
        }

        if (people.length === 0) {
          showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ñ‡∏ô', config.secondary_action_color || defaultConfig.secondary_action_color);
          return;
        }

        let itemsTotal = 0;
        items.forEach(item => {
          itemsTotal += item.price;
        });

        const sharedAmount = totalAmount - itemsTotal;
        const perPersonShared = sharedAmount / people.length;

        const results = people.map(person => {
          let personItemsTotal = 0;
          const personItems = [];

          items.forEach(item => {
            if (item.consumers.includes(person.id)) {
              const itemPerPerson = item.price / item.consumers.length;
              personItemsTotal += itemPerPerson;
              personItems.push({
                name: item.name,
                type: item.type,
                price: itemPerPerson,
                totalPrice: item.price,
                sharedWith: item.consumers.length
              });
            }
          });

          const personTotal = personItemsTotal + perPersonShared;
          return {
            name: person.name,
            items: personItems,
            itemsTotal: personItemsTotal,
            sharedAmount: perPersonShared,
            total: personTotal
          };
        });

        displayResults(results);
      }

      // -----------------------------
      // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì (‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà)
      // -----------------------------
      function displayResults(results) {
        const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
        const resultsContainer = document.getElementById('results-container');

        let html = `
          <div class="fade-in" style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 16px; padding: 28px; box-shadow: 0 8px 16px rgba(0,0,0,0.1); margin-top: 32px;">
            <h3 style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.75}px; font-weight: 800; margin: 0 0 24px 0; text-align: center;">üìä ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</h3>
            <div style="background: ${config.background_color || defaultConfig.background_color}; border-radius: 12px; padding: 20px; margin-bottom: 24px; border: 2px solid ${config.primary_action_color || defaultConfig.primary_action_color};">
              <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; margin-bottom: 8px; font-weight: 600;">üíµ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
              <div style="color: ${config.primary_action_color || defaultConfig.primary_action_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 2.25}px; font-weight: 800;">${totalAmount.toFixed(2)} ‡∏ø</div>
            </div>
        `;

        results.forEach((result, index) => {
          html += `
            <div class="slide-in" style="background: ${config.background_color || defaultConfig.background_color}; border-radius: 12px; padding: 20px; margin-bottom: 16px; border-left: 4px solid ${config.primary_action_color || defaultConfig.primary_action_color}; animation-delay: ${index * 0.1}s;">
              <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.25}px; font-weight: 700; margin-bottom: 16px; display: flex; align-items: center;">
                <span style="background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: white; width: 32px; height: 32px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; margin-right: 12px; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px;">${index + 1}</span>
                ${result.name}
              </div>
          `;

          if (result.items.length > 0) {
            html += `
              <div style="margin-bottom: 12px; background: white; padding: 12px; border-radius: 8px;">
                <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 600; margin-bottom: 12px;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á:</div>
            `;

            result.items.forEach(item => {
              const icon = item.type === 'food' ? 'üçΩÔ∏è' : 'ü•§';
              const shareText = item.sharedWith > 1 ? ` (‡πÅ‡∏ö‡πà‡∏á ${item.sharedWith} ‡∏Ñ‡∏ô)` : '';
              html += `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px dashed ${config.background_color || defaultConfig.background_color};">
                  <div>
                    <span style="margin-right: 8px;">${icon}</span>
                    <span style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px;">${item.name}${shareText}</span>
                  </div>
                  <span style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 600;">${item.price.toFixed(2)} ‡∏ø</span>
                </div>
              `;
            });

            html += `
                <div style="margin-top: 12px; padding-top: 12px; border-top: 2px solid ${config.background_color || defaultConfig.background_color}; display: flex; justify-content: space-between;">
                  <span style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 600;">‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß:</span>
                  <span style="color: ${config.primary_action_color || defaultConfig.primary_action_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 700;">${result.itemsTotal.toFixed(2)} ‡∏ø</span>
                </div>
              </div>
            `;
          }

          html += `
              <div style="background: white; padding: 12px; border-radius: 8px; margin-bottom: 12px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                  <span style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px;">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß:</span>
                  <span style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 600;">${result.itemsTotal.toFixed(2)} ‡∏ø</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                  <span style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px;">‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏≤‡∏£‡∏Å‡∏•‡∏≤‡∏á:</span>
                  <span style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 600;">${result.sharedAmount.toFixed(2)} ‡∏ø</span>
                </div>
              </div>

              <div style="background: ${config.primary_action_color || defaultConfig.primary_action_color}; padding: 16px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                <span style="color: white; font-size: ${(config.font_size || defaultConfig.font_size) * 1.125}px; font-weight: 700;">üí≥ ‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢:</span>
                <span style="color: white; font-size: ${(config.font_size || defaultConfig.font_size) * 1.5}px; font-weight: 800;">${result.total.toFixed(2)} ‡∏ø</span>
              </div>
            </div>
          `;
        });

        html += '</div>';
        resultsContainer.innerHTML = html;
      }

      // -----------------------------
      // Toast ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô
      // -----------------------------
      function showToast(message, color) {
        const toast = document.createElement('div');
        toast.textContent = message;
        toast.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          background: ${color};
          color: white;
          padding: 16px 24px;
          border-radius: 12px;
          box-shadow: 0 8px 16px rgba(0,0,0,0.3);
          z-index: 1000;
          font-weight: 600;
          animation: fadeIn 0.3s ease-in;
        `;
        document.body.appendChild(toast);
        setTimeout(() => {
          toast.style.opacity = '0';
          toast.style.transform = 'translateY(-20px)';
          toast.style.transition = 'all 0.3s ease-out';
          setTimeout(() => toast.remove(), 300);
        }, 3000);
      }

      // -----------------------------
      // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
      // -----------------------------
      function resetForm() {
        people = [];
        items = [];
        totalAmount = 0;
        renderMainView();
        showToast('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß ‚úì', '#077204');
      }

      // -----------------------------
      // ‡∏´‡∏ô‡πâ‡∏≤ "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô"
      // -----------------------------
      function renderPaymentPage() {
        const config = window.elementSdk ? window.elementSdk.config : defaultConfig;

        return `
          <main style="max-width: 800px; margin: 0 auto;">
            <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 20px; padding: 40px; box-shadow: 0 12px 40px rgba(0,0,0,0.12);">
              <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ Payment -->
              <div style="display: flex; align-items: center; margin-bottom: 32px;">
                <button
                  onclick="backToMain()"
                  style="
                    width: 44px;
                    height: 44px;
                    background: ${config.background_color || defaultConfig.background_color};
                    color: ${config.text_color || defaultConfig.text_color};
                    border: none;
                    border-radius: 50%;
                    cursor: pointer;
                    font-size: ${(config.font_size || defaultConfig.font_size) * 1.7}px;
                    font-weight: 900;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    margin-right: 16px;
                    flex-shrink: 0;
                  "
                >‚Üê</button>
                <h1 style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 2}px; font-weight: 900; margin: 0;">üí≥ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h1>
              </div>

              <!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô -->
              <div style="background: ${config.background_color || defaultConfig.background_color}; border-radius: 12px; padding: 20px; margin-bottom: 24px; border-left: 4px solid ${config.primary_action_color || defaultConfig.primary_action_color};">
                <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; line-height: 1.6;">
                  <strong>üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ‡πÄ‡∏ä‡πà‡∏ô PromptPay, ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£, True Money Wallet ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
                </div>
              </div>

              <!-- ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ -->
              <div id="payment-methods-container" style="margin-bottom: 24px;"></div>

              <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô -->
              <button
                onclick="addPaymentMethod()"
                style="width: 100%; padding: 14px; background: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color}; border: 2px dashed ${config.primary_action_color || defaultConfig.primary_action_color}; border-radius: 10px; cursor: pointer; font-size: ${(config.font_size || defaultConfig.font_size)}px; font-weight: 700; margin-bottom: 24px;"
              >‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button>

              <!-- ‡∏õ‡∏∏‡πà‡∏° ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å / ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á -->
              <div style="display: flex; gap: 12px;">
                <button
                  onclick="backToMain()"
                  style="
                    flex: 1;
                    padding: 14px;
                    background: #077204;
                    color: white;
                    border: none;
                    border-radius: 10px;
                    cursor: pointer;
                    font-size: ${(config.font_size || defaultConfig.font_size)}px;
                    font-weight: 700;
                  "
                >‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button
                  onclick="savePaymentInfo()"
                  style="
                    flex: 1;
                    padding: 14px;
                    background: #2eb512;
                    color: white;
                    border: none;
                    border-radius: 10px;
                    cursor: pointer;
                    font-size: ${(config.font_size || defaultConfig.font_size)}px;
                    font-weight: 700;
                    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
                  "
                >üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
              </div>
            </div>
          </main>
        `;
      }

      // -----------------------------
      // ‡∏´‡∏ô‡πâ‡∏≤ "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠"
      // -----------------------------
      function renderContactPage() {
        const config = window.elementSdk ? window.elementSdk.config : defaultConfig;

        return `
          <main style="max-width: 800px; margin: 0 auto;">
            <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 20px; padding: 40px; box-shadow: 0 12px 40px rgba(0,0,0,0.12);">
              <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ Contact -->
              <div style="display: flex; align-items: center; margin-bottom: 32px;">
                <button
                  onclick="backToMain()"
                  style="
                    width: 44px;
                    height: 44px;
                    background: ${config.background_color || defaultConfig.background_color};
                    color: ${config.text_color || defaultConfig.text_color};
                    border: none;
                    border-radius: 50%;
                    cursor: pointer;
                    font-size: ${(config.font_size || defaultConfig.font_size) * 1.7}px;
                    font-weight: 900;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    margin-right: 16px;
                    flex-shrink: 0;
                  "
                >‚Üê</button>
                <h1 style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 2}px; font-weight: 900; margin: 0;">üìû ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</h1>
              </div>

              <!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ -->
              <div style="background: ${config.background_color || defaultConfig.background_color}; border-radius: 12px; padding: 20px; margin-bottom: 24px; border-left: 4px solid ${config.secondary_action_color || defaultConfig.secondary_action_color};">
                <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; line-height: 1.6;">
                  <strong>üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ‡πÄ‡∏ä‡πà‡∏ô ‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå, Line ID, Facebook, Email, Instagram ‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
                </div>
              </div>

              <!-- ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ -->
              <div id="contact-methods-container" style="margin-bottom: 24px;"></div>

              <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ -->
              <button
                onclick="addContactMethod()"
                style="width: 100%; padding: 14px; background: ${config.background_color || defaultConfig.background_color}; color: ${config.text_color || defaultConfig.text_color}; border: 2px dashed #2eb512; border-radius: 10px; cursor: pointer; font-size: ${(config.font_size || defaultConfig.font_size)}px; font-weight: 700; margin-bottom: 24px;"
              >‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</button>

              <!-- ‡∏õ‡∏∏‡πà‡∏° ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å / ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á -->
              <div style="display: flex; gap: 12px;">
                <button
                  onclick="backToMain()"
                  style="
                    flex: 1;
                    padding: 14px;
                    background: #077204;
                    color: white;
                    border: none;
                    border-radius: 10px;
                    cursor: pointer;
                    font-size: ${(config.font_size || defaultConfig.font_size)}px;
                    font-weight: 700;
                  "
                >‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button
                  onclick="saveContactInfo()"
                  style="
                    flex: 1;
                    padding: 14px;
                    background: #2eb512;
                    color: white;
                    border: none;
                    border-radius: 10px;
                    cursor: pointer;
                    font-size: ${(config.font_size || defaultConfig.font_size)}px;
                    font-weight: 700;
                    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
                  "
                >üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
              </div>
            </div>
          </main>
        `;
      }

      // -----------------------------
      // ‡∏´‡∏ô‡πâ‡∏≤ "‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô"
      // -----------------------------
      function renderGuidePage() {
        const config = window.elementSdk ? window.elementSdk.config : defaultConfig;

        return `
          <main style="max-width: 900px; margin: 0 auto;">
            <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 20px; padding: 40px; box-shadow: 0 12px 40px rgba(0,0,0,0.12);">
              <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ Guide -->
              <div style="display: flex; align-items: center; margin-bottom: 32px;">
                <button
                  onclick="backToMain()"
                  style="
                    width: 44px;
                    height: 44px;
                    background: ${config.background_color || defaultConfig.background_color};
                    color: ${config.text_color || defaultConfig.text_color};
                    border: none;
                    border-radius: 50%;
                    cursor: pointer;
                    font-size: ${(config.font_size || defaultConfig.font_size) * 1.7}px;
                    font-weight: 900;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    margin-right: 16px;
                    flex-shrink: 0;
                  "
                >‚Üê</button>
                <h1 style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 2}px; font-weight: 900; margin: 0;">üìò ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h1>
              </div>

              <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠ -->
              <div style="background: ${config.background_color || defaultConfig.background_color}; border-radius: 16px; padding: 24px; margin-bottom: 24px;">
                <p style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.95}px; line-height: 1.8; margin: 0;">
                  ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏ô‡∏µ‡πâ‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÄ‡∏ß‡πá‡∏ö <strong>‚Äú‡πÅ‡∏ö‡πà‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏¢‡∏∏‡∏ï‡∏¥‡∏ò‡∏£‡∏£‡∏°‚Äù</strong> ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏à‡∏ô‡∏ñ‡∏∂‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢ ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏õ‡∏Å‡∏¥‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß/‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏≠‡∏¢‡∏≤‡∏Å‡∏´‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏ö‡∏ö‡∏¢‡∏∏‡∏ï‡∏¥‡∏ò‡∏£‡∏£‡∏°
                </p>
              </div>

              <!-- ‡∏•‡∏¥‡∏™‡∏ï‡πå‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠ -->
              <ol style="list-style: none; padding: 0; margin: 0;">
                <!-- ‡πÅ‡∏ï‡πà‡∏•‡∏∞ li ‡∏Ñ‡∏∑‡∏≠ 1 ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÉ‡∏ô‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠ -->
                <li style="margin-bottom: 18px; background: white; padding: 16px 18px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.05);">
                  <div style="display: flex; gap: 12px;">
                    <div style="width: 32px; height: 32px; border-radius: 50%; background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: white; display: flex; align-items: center; justify-content: center; font-weight: 700;">1</div>
                    <div>
                      <div style="font-weight: 700; color: ${config.text_color || defaultConfig.text_color}; margin-bottom: 4px;">‡∏Å‡∏£‡∏≠‡∏Å‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ö‡∏¥‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                      <div style="font-size: ${(config.font_size || defaultConfig.font_size) * 0.9}px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.8;">
                        ‡πÉ‡∏™‡πà‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏ö‡∏¥‡∏• ‡πÄ‡∏ä‡πà‡∏ô 1,250 ‡∏ö‡∏≤‡∏ó ‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á <strong>‚Äú‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏ö‡∏≤‡∏ó)‚Äù</strong>
                      </div>
                    </div>
                  </div>
                </li>

                <li style="margin-bottom: 18px; background: white; padding: 16px 18px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.05);">
                  <div style="display: flex; gap: 12px;">
                    <div style="width: 32px; height: 32px; border-radius: 50%; background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: white; display: flex; align-items: center; justify-content: center; font-weight: 700;">2</div>
                    <div>
                      <div style="font-weight: 700; color: ${config.text_color || defaultConfig.text_color}; margin-bottom: 4px;">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°</div>
                      <div style="font-size: ${(config.font_size || defaultConfig.font_size) * 0.9}px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.8;">
                        ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° <strong>‚Äú+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ô‚Äù</strong> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô/‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
                      </div>
                    </div>
                  </div>
                </li>

                <li style="margin-bottom: 18px; background: white; padding: 16px 18px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.05);">
                  <div style="display: flex; gap: 12px;">
                    <div style="width: 32px; height: 32px; border-radius: 50%; background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: white; display: flex; align-items: center; justify-content: center; font-weight: 700;">3</div>
                    <div>
                      <div style="font-weight: 700; color: ${config.text_color || defaultConfig.text_color}; margin-bottom: 4px;">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°</div>
                      <div style="font-size: ${(config.font_size || defaultConfig.font_size) * 0.9}px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.8;">
                        ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° <strong>‚Äú+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‚Äù</strong> ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤ ‡πÄ‡∏ä‡πà‡∏ô ‚Äú‡∏™‡πâ‡∏°‡∏ï‡∏≥‚Äù, ‚Äú‡∏ä‡∏≤‡∏ô‡∏°‚Äù, ‚Äú‡∏û‡∏¥‡∏ã‡∏ã‡πà‡∏≤‡πÉ‡∏´‡∏ç‡πà‚Äù ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°
                      </div>
                    </div>
                  </div>
                </li>

                <li style="margin-bottom: 18px; background: white; padding: 16px 18px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.05);">
                  <div style="display: flex; gap: 12px;">
                    <div style="width: 32px; height: 32px; border-radius: 50%; background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: white; display: flex; align-items: center; justify-content: center; font-weight: 700;">4</div>
                    <div>
                      <div style="font-weight: 700; color: ${config.text_color || defaultConfig.text_color}; margin-bottom: 4px;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡πà‡∏≤ ‚Äú‡πÉ‡∏Ñ‡∏£‡∏Å‡∏¥‡∏ô‡∏≠‡∏∞‡πÑ‡∏£‚Äù</div>
                      <div style="font-size: ${(config.font_size || defaultConfig.font_size) * 0.9}px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.8;">
                        ‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡πÉ‡∏´‡πâ‡∏ï‡∏¥‡πä‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡πÄ‡∏°‡∏ô‡∏π‡∏ô‡∏±‡πâ‡∏ô ‡πÜ ‡∏´‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô‡πÅ‡∏ä‡∏£‡πå‡πÄ‡∏°‡∏ô‡∏π‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏ö‡πà‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡πÉ‡∏´‡πâ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                      </div>
                    </div>
                  </div>
                </li>

                <li style="margin-bottom: 18px; background: white; padding: 16px 18px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.05);">
                  <div style="display: flex; gap: 12px;">
                    <div style="width: 32px; height: 32px; border-radius: 50%; background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: white; display: flex; align-items: center; justify-content: center; font-weight: 700;">5</div>
                    <div>
                      <div style="font-weight: 700; color: ${config.text_color || defaultConfig.text_color}; margin-bottom: 4px;">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° ‚Äú‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‚Äù</div>
                      <div style="font-size: ${(config.font_size || defaultConfig.font_size) * 0.9}px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.8;">
                        ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏£‡∏∏‡∏õ‡πÉ‡∏´‡πâ‡∏ß‡πà‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà ‡πÅ‡∏¢‡∏Å‡πÄ‡∏õ‡πá‡∏ô <strong>‚Äú‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‚Äù</strong> ‡πÅ‡∏•‡∏∞ <strong>‚Äú‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏≤‡∏£‡∏Å‡∏•‡∏≤‡∏á‚Äù</strong>
                      </div>
                    </div>
                  </div>
                </li>

                <li style="margin-bottom: 18px; background: white; padding: 16px 18px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.05);">
                  <div style="display: flex; gap: 12px;">
                    <div style="width: 32px; height: 32px; border-radius: 50%; background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: white; display: flex; align-items: center; justify-content: center; font-weight: 700;">6</div>
                    <div>
                      <div style="font-weight: 700; color: ${config.text_color || defaultConfig.text_color}; margin-bottom: 4px;">‡∏î‡∏π‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏•‡∏∞‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</div>
                      <div style="font-size: ${(config.font_size || defaultConfig.font_size) * 0.9}px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.8;">
                        ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° <strong>‚Äúüìã ‡∏î‡∏π‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ‚Äù</strong> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏ß‡πâ
                      </div>
                    </div>
                  </div>
                </li>
              </ol>
            </div>
          </main>
        `;
      }

      // -----------------------------
      // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° (‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤)
      // -----------------------------
      function renderPeople() {
        const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
        const container = document.getElementById('people-container');

        if (!container) return;

        if (people.length === 0) {
          container.innerHTML = `
            <div style="text-align: center; padding: 40px 20px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.6;">
              <div style="font-size: ${(config.font_size || defaultConfig.font_size) * 3}px; margin-bottom: 12px;">üë•</div>
              <div style="font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px;">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ô</div>
            </div>
          `;
          return;
        }

        let html = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px;">';
        people.forEach((person, index) => {
          html += `
            <div class="card-hover" style="background: ${config.background_color || defaultConfig.background_color}; border-radius: 10px; padding: 16px; display: flex; flex-direction: column; gap: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
              <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                <span style="background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: white; width: 28px; height: 28px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-weight: 700; font-size: ${(config.font_size || defaultConfig.font_size) * 0.75}px; flex-shrink: 0;">${index + 1}</span>
                <input
                  type="text"
                  value="${person.name}"
                  onchange="updatePersonName(${person.id}, this.value)"
                  aria-label="‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô"
                  style="flex: 1; padding: 6px 10px; border: 2px solid white; border-radius: 6px; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; color: ${config.text_color || defaultConfig.text_color}; font-weight: 600; min-width: 0;"
                />
              </div>
              <button
                onclick="removePerson(${person.id})"
                aria-label="‡∏•‡∏ö‡∏Ñ‡∏ô"
                style="width: 100%; padding: 6px 12px; background: #0EA5E9; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: ${(config.font_size || defaultConfig.font_size) * 0.75}px; font-weight: 600;"
              >üóëÔ∏è ‡∏•‡∏ö</button>
            </div>
          `;
        });
        html += '</div>';

        container.innerHTML = html;
      }

      // -----------------------------
      // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°
      // -----------------------------
      function renderItems() {
        const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
        const container = document.getElementById('items-container');
        if (!container) return;

        if (items.length === 0) {
          container.innerHTML = `
            <div style="text-align: center; padding: 40px 20px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.6;">
              <div style="font-size: ${(config.font_size || defaultConfig.font_size) * 3}px; margin-bottom: 12px;">üçΩÔ∏è</div>
              <div style="font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px;">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
            </div>
          `;
          return;
        }

        let html = '';
        items.forEach((item) => {
          html += `
            <div class="card-hover slide-in" style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 12px; padding: 20px; margin-bottom: 16px; box-shadow: 0 4px 8px rgba(0,0,0,0.08); border-left: 4px solid ${item.type === 'food' ? config.primary_action_color || defaultConfig.primary_action_color : config.secondary_action_color || defaultConfig.secondary_action_color};">
              <div style="display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap;">
                <!-- ‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π -->
                <div style="flex: 1; min-width: 200px;">
                  <label for="item-name-${item.id}" style="display: block; color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.75}px; font-weight: 600; margin-bottom: 6px; opacity: 0.7;">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label>
                  <input
                    id="item-name-${item.id}"
                    type="text"
                    placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ú‡∏±‡∏î‡πÑ‡∏ó‡∏¢, ‡∏ô‡πâ‡∏≥‡∏™‡πâ‡∏°"
                    value="${item.name}"
                    onchange="updateItemName(${item.id}, this.value)"
                    aria-label="‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"
                    style="width: 100%; padding: 10px 14px; border: 2px solid ${config.background_color || defaultConfig.background_color}; border-radius: 8px; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; color: ${config.text_color || defaultConfig.text_color}; font-weight: 600;"
                  />
                </div>

                <!-- ‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤ -->
                <div style="width: 120px;">
                  <label for="item-price-${item.id}" style="display: block; color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.75}px; font-weight: 600; margin-bottom: 6px; opacity: 0.7;">‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ø)</label>
                  <input
                    id="item-price-${item.id}"
                    type="number"
                    placeholder="0.00"
                    value="${item.price || ''}"
                    onchange="updateItemPrice(${item.id}, this.value)"
                    aria-label="‡∏£‡∏≤‡∏Ñ‡∏≤"
                    style="width: 100%; padding: 10px 14px; border: 2px solid ${config.background_color || defaultConfig.background_color}; border-radius: 8px; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; color: ${config.text_color || defaultConfig.text_color}; font-weight: 700;"
                  />
                </div>

                <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏°‡∏ô‡∏π -->
                <div style="width: 140px;">
                  <label for="item-type-${item.id}" style="display: block; color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.75}px; font-weight: 600; margin-bottom: 6px; opacity: 0.7;">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
                  <select
                    id="item-type-${item.id}"
                    onchange="updateItemType(${item.id}, this.value)"
                    aria-label="‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"
                    style="width: 100%; padding: 10px 14px; border: 2px solid ${config.background_color || defaultConfig.background_color}; border-radius: 8px; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; color: ${config.text_color || defaultConfig.text_color}; font-weight: 600; cursor: pointer; background: white;"
                  >
                    <option value="food" ${item.type === 'food' ? 'selected' : ''}>üçΩÔ∏è ‡∏≠‡∏≤‡∏´‡∏≤‡∏£</option>
                    <option value="drink" ${item.type === 'drink' ? 'selected' : ''}>ü•§ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°</option>
                  </select>
                </div>

                <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ -->
                <div style="display: flex; align-items: flex-end;">
                  <button
                    onclick="removeItem(${item.id})"
                    aria-label="‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"
                    style="padding: 10px 16px; background: ${config.secondary_action_color || defaultConfig.secondary_action_color}; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 600; height: 42px;"
                  >üóëÔ∏è</button>
                </div>
              </div>
          `;

          if (people.length > 0) {
            html += `
              <!-- ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡πÉ‡∏Ñ‡∏£‡∏Å‡∏¥‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡∏ô‡∏µ‡πâ -->
              <div style="background: ${config.background_color || defaultConfig.background_color}; padding: 16px; border-radius: 8px;">
                <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 700; margin-bottom: 12px;">‡πÉ‡∏Ñ‡∏£‡∏™‡∏±‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ? (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô)</div>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 8px;">
            `;

            people.forEach(person => {
              const isChecked = item.consumers.includes(person.id);
              html += `
                <label style="display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: white; border-radius: 6px; cursor: pointer; border: 2px solid ${isChecked ? config.primary_action_color || defaultConfig.primary_action_color : 'transparent'};">
                  <input
                    type="checkbox"
                    ${isChecked ? 'checked' : ''}
                    onchange="toggleConsumer(${item.id}, ${person.id})"
                    class="checkbox-custom"
                    aria-label="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ${person.name}"
                  />
                  <span style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 600;">${person.name}</span>
                </label>
              `;
            });

            html += `
                </div>
              </div>
            `;
          } else {
            html += `
              <div style="background: ${config.background_color || defaultConfig.background_color}; padding: 16px; border-radius: 8px; text-align: center; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.6; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px;">
                ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡πÉ‡∏Ñ‡∏£‡∏™‡∏±‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ
              </div>
            `;
          }

          html += `
            </div>
          `;
        });

        container.innerHTML = html;
      }

      // -----------------------------
      // onConfigChange: ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô config ‡πÉ‡∏ô Canva
      // -----------------------------
      async function onConfigChange(config) {
        const customFont = config.font_family || defaultConfig.font_family;
        const baseFontStack = 'K2D, Segoe UI, Tahoma, Geneva, Verdana, sans-serif';

        document.body.style.fontFamily = `${customFont}, ${baseFontStack}`;

        const wrapper = document.getElementById('app-wrapper');
        if (wrapper) {
          wrapper.style.background = config.background_color || defaultConfig.background_color;
          wrapper.style.minHeight = '100%';
          wrapper.style.padding = '40px 20px';
        }

        const container = document.getElementById('main-container');
        if (container) {
          container.style.background = config.surface_color || defaultConfig.surface_color;
        }

        const title = document.getElementById('app-title');
        if (title) {
          title.textContent = config.app_title || defaultConfig.app_title;
          title.style.color = config.text_color || defaultConfig.text_color;
          title.style.fontSize = `${(config.font_size || defaultConfig.font_size) * 2}px`;
        }

        const subtitle = document.getElementById('app-subtitle');
        if (subtitle) {
          subtitle.textContent = config.app_subtitle || defaultConfig.app_subtitle;
          subtitle.style.color = config.text_color || defaultConfig.text_color;
          subtitle.style.fontSize = `${(config.font_size || defaultConfig.font_size) * 0.875}px`;
        }

        const totalLabel = document.getElementById('total-label');
        if (totalLabel) {
          totalLabel.textContent = config.total_amount_label || defaultConfig.total_amount_label;
          totalLabel.style.color = config.text_color || defaultConfig.text_color;
          totalLabel.style.fontSize = `${(config.font_size || defaultConfig.font_size) * 0.875}px`;
        }

        const peopleTitle = document.getElementById('people-section-title');
        if (peopleTitle) {
          peopleTitle.textContent = config.people_section_title || defaultConfig.people_section_title;
          peopleTitle.style.color = config.text_color || defaultConfig.text_color;
          peopleTitle.style.fontSize = `${(config.font_size || defaultConfig.font_size) * 1.25}px`;
        }

        const itemsTitle = document.getElementById('items-section-title');
        if (itemsTitle) {
          itemsTitle.textContent = config.items_section_title || defaultConfig.items_section_title;
          itemsTitle.style.color = config.text_color || defaultConfig.text_color;
          itemsTitle.style.fontSize = `${(config.font_size || defaultConfig.font_size) * 1.25}px`;
        }

        const addPersonBtn = document.getElementById('add-person-btn');
        if (addPersonBtn) {
          addPersonBtn.textContent = config.add_person_button || defaultConfig.add_person_button;
          addPersonBtn.style.background = '#0EA5E9';
          addPersonBtn.style.fontSize = `${(config.font_size || defaultConfig.font_size) * 0.875}px`;
        }

        const addItemBtn = document.getElementById('add-item-btn');
        if (addItemBtn) {
          addItemBtn.textContent = config.add_item_button || defaultConfig.add_item_button;
          addItemBtn.style.background = config.secondary_action_color || defaultConfig.secondary_action_color;
          addItemBtn.style.fontSize = `${(config.font_size || defaultConfig.font_size) * 0.875}px`;
        }

        const scanBillBtn = document.getElementById('scan-bill-btn');
        if (scanBillBtn) {
          scanBillBtn.textContent = config.scan_bill_button || defaultConfig.scan_bill_button;
          scanBillBtn.style.background = config.secondary_action_color || defaultConfig.secondary_action_color;
          scanBillBtn.style.fontSize = `${(config.font_size || defaultConfig.font_size) * 0.875}px`;
        }

        const viewSummaryBtn = document.getElementById('view-summary-btn');
        if (viewSummaryBtn) {
          viewSummaryBtn.textContent = config.view_summary_button || defaultConfig.view_summary_button;
          viewSummaryBtn.style.background = 'white';
          viewSummaryBtn.style.color = config.text_color || defaultConfig.text_color;
          viewSummaryBtn.style.border = `2px solid #cccccc`;
          viewSummaryBtn.style.fontSize = `${(config.font_size || defaultConfig.font_size) * 0.875}px`;
        }

        const managePaymentBtn = document.getElementById('manage-payment-btn');
        if (managePaymentBtn) {
          managePaymentBtn.style.background = 'white';
          managePaymentBtn.style.color = config.text_color || defaultConfig.text_color;
          managePaymentBtn.style.border = `2px solid #cccccc`;
        }

        const manageContactBtn = document.getElementById('manage-contact-btn');
        if (manageContactBtn) {
          manageContactBtn.style.background = 'white';
          manageContactBtn.style.color = config.text_color || defaultConfig.text_color;
          manageContactBtn.style.border = `2px solid #cccccc`;
        }

        const guideBtn = document.getElementById('guide-btn');
        if (guideBtn) {
          guideBtn.style.background = 'white';
          guideBtn.style.color = config.text_color || defaultConfig.text_color;
          guideBtn.style.border = `2px solid #cccccc`;
          guideBtn.style.fontSize = `${(config.font_size || defaultConfig.font_size) * 0.875}px`;
        }

        const calculateBtn = document.getElementById('calculate-btn');
        if (calculateBtn) {
          calculateBtn.textContent = config.calculate_button || defaultConfig.calculate_button;
          calculateBtn.style.background = config.primary_action_color || defaultConfig.primary_action_color;
          calculateBtn.style.fontSize = `${(config.font_size || defaultConfig.font_size) * 1.125}px`;
        }

        const resetBtn = document.getElementById('reset-btn');
        if (resetBtn) {
          resetBtn.textContent = config.reset_button || defaultConfig.reset_button;
          resetBtn.style.background = config.secondary_action_color || defaultConfig.secondary_action_color;
          resetBtn.style.fontSize = `${(config.font_size || defaultConfig.font_size)}px`;
        }

        const totalInput = document.getElementById('total-amount');
        if (totalInput) {
          totalInput.style.fontSize = `${(config.font_size || defaultConfig.font_size) * 1.125}px`;
          totalInput.style.color = config.text_color || defaultConfig.text_color;
          totalInput.style.border = '3px solid #cccccc';
        }

        renderPeople();
        renderItems();
      }

      // -----------------------------
      // renderApp: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡πÅ‡∏™‡∏î‡∏á view ‡πÑ‡∏´‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ
      // -----------------------------
      function renderApp() {
        const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
        const wrapper = document.getElementById('app-wrapper');
        wrapper.style.background = config.background_color || defaultConfig.background_color;

        if (currentView === 'payment') {
          wrapper.innerHTML = renderPaymentPage();
          setTimeout(() => renderPaymentMethodsEdit(), 0);
          return;
        }

        if (currentView === 'contact') {
          wrapper.innerHTML = renderContactPage();
          setTimeout(() => renderContactMethodsEdit(), 0);
          return;
        }

        if (currentView === 'summary') {
          wrapper.innerHTML = renderSummaryPage();
          return;
        }

        if (currentView === 'guide') {
          wrapper.innerHTML = renderGuidePage();
          return;
        }

        renderMainView();
      }

      // -----------------------------
      // ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å (Main View) ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö
      // -----------------------------
      function renderMainView() {
        const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
        const customFont = config.font_family || defaultConfig.font_family;
        const baseFontStack = 'K2D, Segoe UI, Tahoma, Geneva, Verdana, sans-serif';

        document.body.style.fontFamily = `${customFont}, ${baseFontStack}`;

        const wrapper = document.getElementById('app-wrapper');
        wrapper.style.background = config.background_color || defaultConfig.background_color;

        wrapper.innerHTML = `
          <main style="max-width: 1000px; margin: 0 auto;">
            <!-- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏õ -->
            <div id="main-container" style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 20px; padding: 36px; box-shadow: 0 12px 40px rgba(0,0,0,0.12);">
              <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß‡πÄ‡∏ß‡πá‡∏ö (‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏≠‡∏õ + ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢) -->
              <header style="text-align: center; margin-bottom: 36px;">
                <h1 id="app-title" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 2}px; font-weight: 900; margin: 0 0 12px 0;">${config.app_title || defaultConfig.app_title}</h1>
                <p id="app-subtitle" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; margin: 0; opacity: 0.7;">${config.app_subtitle || defaultConfig.app_subtitle}</p>
              </header>

              <!-- ‡πÅ‡∏ñ‡∏ß‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô (‡∏î‡∏π‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ / ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô / ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ / ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠) -->
              <div style="display: flex; gap: 12px; margin-bottom: 24px; flex-wrap: wrap;">
                <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏π‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ (Summary) -->
                <button
                  id="view-summary-btn"
                  onclick="openSummaryModal()"
                  style="
                    flex: 1;
                    min-width: 150px;
                    padding: 12px 16px;
                    background: white;
                    color: ${config.text_color || defaultConfig.text_color};
                    border: 2px solid #cccccc;
                    border-radius: 10px;
                    cursor: pointer;
                    font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px;
                    font-weight: 600;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
                  "
                >${config.view_summary_button || defaultConfig.view_summary_button}</button>

                <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô -->
                <button
                  id="manage-payment-btn"
                  onclick="openPaymentPage()"
                  style="
                    flex: 1;
                    min-width: 150px;
                    padding: 12px 16px;
                    background: white;
                    color: ${config.text_color || defaultConfig.text_color};
                    border: 2px solid #cccccc;
                    border-radius: 10px;
                    cursor: pointer;
                    font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px;
                    font-weight: 600;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
                  "
                >üí≥ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button>

                <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ -->
                <button
                  id="manage-contact-btn"
                  onclick="openContactPage()"
                  style="
                    flex: 1;
                    min-width: 150px;
                    padding: 12px 16px;
                    background: white;
                    color: ${config.text_color || defaultConfig.text_color};
                    border: 2px solid #cccccc;
                    border-radius: 10px;
                    cursor: pointer;
                    font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px;
                    font-weight: 600;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
                  "
                >üìû ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</button>

                <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô -->
                <button
                  id="guide-btn"
                  onclick="openGuidePage()"
                  style="
                    flex: 1;
                    min-width: 150px;
                    padding: 12px 16px;
                    background: white;
                    color: ${config.text_color || defaultConfig.text_color};
                    border: 2px solid #cccccc;
                    border-radius: 10px;
                    cursor: pointer;
                    font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px;
                    font-weight: 600;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
                  "
                >üìò ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</button>
              </div>

              <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡∏ö‡∏¥‡∏• -->
              <div style="margin-bottom: 32px;">
                <label id="total-label" for="total-amount" style="display: block; color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 700; margin-bottom: 10px;">${config.total_amount_label || defaultConfig.total_amount_label}</label>
                <input
                  type="number"
                  id="total-amount"
                  placeholder="0.00"
                  value="${totalAmount || ''}"
                  onchange="saveTotalAmount()"
                  aria-label="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"
                  style="
                    width: 100%;
                    padding: 14px 18px;
                    border: 3px solid #cccccc;
                    border-radius: 10px;
                    font-size: ${(config.font_size || defaultConfig.font_size) * 1.125}px;
                    color: ${config.text_color || defaultConfig.text_color};
                    font-weight: 700;
                  "
                />
              </div>

              <!-- ‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏° -->
              <div style="margin-bottom: 32px; background: ${config.background_color || defaultConfig.background_color}; padding: 24px; border-radius: 16px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                  <h2 id="people-section-title" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.25}px; font-weight: 800; margin: 0;">${config.people_section_title || defaultConfig.people_section_title}</h2>
                  <button
                    id="add-person-btn"
                    onclick="addPerson()"
                    style="padding: 10px 20px; background: #0EA5E9; color: white; border: none; border-radius: 10px; cursor: pointer; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 700; box-shadow: 0 4px 8px rgba(0,0,0,0.15);"
                  >${config.add_person_button || defaultConfig.add_person_button}</button>
                </div>
                <!-- container ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô -->
                <div id="people-container"></div>
              </div>

              <!-- ‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏° -->
              <div style="margin-bottom: 32px; background: ${config.background_color || defaultConfig.background_color}; padding: 24px; border-radius: 16px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                  <h2 id="items-section-title" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${(config.font_size || defaultConfig.font_size) * 1.25}px; font-weight: 800; margin: 0;">${config.items_section_title || defaultConfig.items_section_title}</h2>
                  <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
                    <button
                      id="scan-bill-btn"
                      onclick="openBillScan()"
                      style="padding: 10px 20px; background: ${config.secondary_action_color || defaultConfig.secondary_action_color}; color: white; border: none; border-radius: 10px; cursor: pointer; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 700; box-shadow: 0 4px 8px rgba(0,0,0,0.15);"
                    >${config.scan_bill_button || defaultConfig.scan_bill_button}</button>
                    <button
                      id="add-item-btn"
                      onclick="addItem()"
                      style="padding: 10px 20px; background: ${config.secondary_action_color || defaultConfig.secondary_action_color}; color: white; border: none; border-radius: 10px; cursor: pointer; font-size: ${(config.font_size || defaultConfig.font_size) * 0.875}px; font-weight: 700; box-shadow: 0 4px 8px rgba(0,0,0,0.15);"
                    >${config.add_item_button || defaultConfig.add_item_button}</button>
                  </div>
                </div>
                <!-- container ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π -->
                <div id="items-container"></div>
              </div>

              <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì / ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á -->
              <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                <button
                  id="calculate-btn"
                  onclick="calculateSplit()"
                  style="flex: 2; min-width: 200px; padding: 18px; background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: white; border: none; border-radius: 10px; cursor: pointer; font-size: ${(config.font_size || defaultConfig.font_size) * 1.125}px; font-weight: 800; box-shadow: 0 6px 12px rgba(0,0,0,0.15);"
                >${config.calculate_button || defaultConfig.calculate_button}</button>
                <button
                  id="reset-btn"
                  onclick="resetForm()"
                  style="padding: 18px 28px; background: ${config.secondary_action_color || defaultConfig.secondary_action_color}; color: white; border: none; border-radius: 10px; cursor: pointer; font-size: ${(config.font_size || defaultConfig.font_size)}px; font-weight: 700; box-shadow: 0 6px 12px rgba(0,0,0,0.15);"
                >${config.reset_button || defaultConfig.reset_button}</button>
              </div>

              <!-- Container ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì -->
              <div id="results-container"></div>
            

              ${showScanModal ? `
                <div class="modal-overlay" onclick="closeBillScan()">
                  <div class="modal-content" onclick="event.stopPropagation()" style="width: 100%; background: white; padding: 26px; border-radius: 20px;">
                    <div style="display:flex; justify-content: space-between; align-items:center; margin-bottom: 14px;">
                      <h3 style="margin:0; font-weight: 900; font-size: ${(config.font_size || defaultConfig.font_size) * 1.35}px; color: ${config.text_color || defaultConfig.text_color};">üì∑ ‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏¥‡∏•</h3>
                      <button onclick="closeBillScan()" style="width:40px;height:40px;border-radius:999px;border:none;background:${config.background_color || defaultConfig.background_color};cursor:pointer;font-size:18px;font-weight:900;">‚úï</button>
                    </div>

                    <div style="background:${config.background_color || defaultConfig.background_color}; border-radius: 12px; padding: 14px; margin-bottom: 14px; color:${config.text_color || defaultConfig.text_color}; font-size:${(config.font_size || defaultConfig.font_size) * 0.9}px; line-height:1.6;">
                      ‡∏ñ‡πà‡∏≤‡∏¢/‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏ö‡∏¥‡∏•‡πÉ‡∏´‡πâ <strong>‡∏ä‡∏±‡∏î ‡πÑ‡∏°‡πà‡πÄ‡∏≠‡∏µ‡∏¢‡∏á ‡πÅ‡∏™‡∏á‡∏û‡∏≠‡∏î‡∏µ</strong> ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏î‡∏∂‡∏á <strong>‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ + ‡∏£‡∏≤‡∏Ñ‡∏≤</strong> ‡πÑ‡∏õ‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                    </div>

                    <input
                      id="bill-file-input"
                      type="file"
                      accept="image/*"
                      onchange="handleBillFile(this.files && this.files[0])"
                      style="width:100%; padding: 12px; border: 2px dashed ${config.secondary_action_color || defaultConfig.secondary_action_color}; border-radius: 12px; cursor:pointer; margin-bottom: 14px;"
                    />

                    ${scanBusy ? `
                      <div style="margin-top: 6px;">
                        <div style="display:flex; justify-content: space-between; align-items:center; margin-bottom: 8px;">
                          <div style="font-weight: 800; color:${config.text_color || defaultConfig.text_color};">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡πà‡∏≤‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏à‡∏≤‡∏Å‡∏ö‡∏¥‡∏•‚Ä¶</div>
                          <div id="scan-progress-text" style="font-weight: 900; color:${config.secondary_action_color || defaultConfig.secondary_action_color};">${scanProgress}%</div>
                        </div>
                        <div style="width:100%; height: 12px; background:${config.background_color || defaultConfig.background_color}; border-radius: 999px; overflow:hidden; border: 1px solid rgba(0,0,0,0.08);">
                          <div id="scan-progress-bar" style="height:100%; width:${scanProgress}%; background:${config.secondary_action_color || defaultConfig.secondary_action_color}; transition: width .15s ease;"></div>
                        </div>
                        <div style="margin-top: 10px; font-size:${(config.font_size || defaultConfig.font_size) * 0.8}px; opacity:.75;">
                          ‡∏ñ‡πâ‡∏≤‡∏ô‡∏≤‡∏ô‡∏°‡∏≤‡∏Å ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô/‡πÑ‡∏°‡πà‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡πÅ‡∏™‡∏á
                        </div>
                      </div>
                    ` : ''}

                    ${scanError ? `
                      <div style="margin-top: 12px; background: #fff1f2; color:#9f1239; padding: 12px 14px; border-radius: 12px; font-weight: 700;">
                        ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${scanError}
                      </div>
                    ` : ''}

                    ${scanRawText ? `
                      <details style="margin-top: 14px;">
                        <summary style="cursor:pointer; font-weight: 800;">‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏™‡πÅ‡∏Å‡∏ô‡πÑ‡∏î‡πâ (Raw OCR)</summary>
                        <pre style="white-space: pre-wrap; background: ${config.background_color || defaultConfig.background_color}; padding: 12px; border-radius: 12px; margin-top: 10px; max-height: 220px; overflow:auto; font-size:${(config.font_size || defaultConfig.font_size) * 0.8}px;">${scanRawText}</pre>
                      </details>
                    ` : ''}

                    <div style="display:flex; gap: 10px; margin-top: 16px;">
                      <button onclick="closeBillScan()" style="flex:1; padding: 12px 14px; border-radius: 12px; border: 2px solid #e5e7eb; background: white; cursor:pointer; font-weight: 800;">‡∏õ‡∏¥‡∏î</button>
                      <button onclick="document.getElementById('bill-file-input').click()" style="flex:1; padding: 12px 14px; border-radius: 12px; border:none; background: ${config.secondary_action_color || defaultConfig.secondary_action_color}; color:white; cursor:pointer; font-weight: 900;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà</button>
                    </div>
                  </div>
                </div>
              ` : ''}</div>
          </main>
        `;

        renderPeople();
        renderItems();
      }

      // -----------------------------
      // initApp: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏õ
      // -----------------------------
      async function initApp() {
        if (window.elementSdk) {
          await window.elementSdk.init({
            defaultConfig,
            onConfigChange,
            mapToCapabilities: (config) => ({
              recolorables: [
                {
                  get: () => config.background_color || defaultConfig.background_color,
                  set: (value) => {
                    config.background_color = value;
                    window.elementSdk.setConfig({ background_color: value });
                  }
                },
                {
                  get: () => config.surface_color || defaultConfig.surface_color,
                  set: (value) => {
                    config.surface_color = value;
                    window.elementSdk.setConfig({ surface_color: value });
                  }
                },
                {
                  get: () => config.text_color || defaultConfig.text_color,
                  set: (value) => {
                    config.text_color = value;
                    window.elementSdk.setConfig({ text_color: value });
                  }
                },
                {
                  get: () => config.primary_action_color || defaultConfig.primary_action_color,
                  set: (value) => {
                    config.primary_action_color = value;
                    window.elementSdk.setConfig({ primary_action_color: value });
                  }
                },
                {
                  get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
                  set: (value) => {
                    config.secondary_action_color = value;
                    window.elementSdk.setConfig({ secondary_action_color: value });
                  }
                }
              ],
              borderables: [],
              fontEditable: {
                get: () => config.font_family || defaultConfig.font_family,
                set: (value) => {
                  config.font_family = value;
                  window.elementSdk.setConfig({ font_family: value });
                }
              },
              fontSizeable: {
                get: () => config.font_size || defaultConfig.font_size,
                set: (value) => {
                  config.font_size = value;
                  window.elementSdk.setConfig({ font_size: value });
                }
              }
            }),
            mapToEditPanelValues: (config) => new Map([
              ["app_title", config.app_title || defaultConfig.app_title],
              ["app_subtitle", config.app_subtitle || defaultConfig.app_subtitle],
              ["total_amount_label", config.total_amount_label || defaultConfig.total_amount_label],
              ["people_section_title", config.people_section_title || defaultConfig.people_section_title],
              ["add_person_button", config.add_person_button || defaultConfig.add_person_button],
              ["items_section_title", config.items_section_title || defaultConfig.items_section_title],
              ["add_item_button", config.add_item_button || defaultConfig.add_item_button],
              ["calculate_button", config.calculate_button || defaultConfig.calculate_button],
              ["reset_button", config.reset_button || defaultConfig.reset_button],
              ["summary_title", config.summary_title || defaultConfig.summary_title],
              ["view_summary_button", config.view_summary_button || defaultConfig.view_summary_button],
              ["contact_title", config.contact_title || defaultConfig.contact_title],
              ["contact_method_1", config.contact_method_1 || defaultConfig.contact_method_1],
              ["contact_detail_1", config.contact_detail_1 || defaultConfig.contact_detail_1],
              ["contact_method_2", config.contact_method_2 || defaultConfig.contact_method_2],
              ["contact_detail_2", config.contact_detail_2 || defaultConfig.contact_detail_2]
            ])
          });
        }

        renderMainView();
      }

      // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏≠‡∏õ
      initApp();
    </script>

    <!-- script cloudflare ‡πÄ‡∏î‡∏¥‡∏° (‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Bot ‡∏ñ‡πâ‡∏≤‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏° ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô) -->
    <script>
      (function(){
        function c(){
          var b=a.contentDocument||a.contentWindow.document;
          if(b){
            var d=b.createElement('script');
            d.innerHTML="window.__CF$cv$params={r:'9a79ecfa236fd034',t:'MTc2NDY2OTA4Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";
            b.getElementsByTagName('head')[0].appendChild(d)
          }
        }
        if(document.body){
          var a=document.createElement('iframe');
          a.height=1;
          a.width=1;
          a.style.position='absolute';
          a.style.top=0;
          a.style.left=0;
          a.style.border='none';
          a.style.visibility='hidden';
          document.body.appendChild(a);
          if('loading'!==document.readyState)c();
          else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);
          else{
            var e=document.onreadystatechange||function(){};
            document.onreadystatechange=function(b){
              e(b);
              'loading'!==document.readyState&&(document.onreadystatechange=e,c())
            }
          }
        }
      })();
    </script>
  </body>
</html>
